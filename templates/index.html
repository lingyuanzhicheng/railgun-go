<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Railgun</title>
    <link rel="icon" href="static/logo.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: url("static/background.png") no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .top-container {
            width: 100%;
            max-width: 1200px;
            margin-bottom: 20px;
        }

        .input-button-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            gap: 20px;
        }

        .uuid-input {
            flex: 2.5;
            padding: 15px;
            border-radius: 10px;
            border: none;
            background-color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(31, 38, 135, 0.1);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s ease;
        }

        .uuid-input:focus {
            outline: none;
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
        }

        .action-button {
            flex: 1;
            padding: 12px 20px;
            border-radius: 10px;
            border: none;
            background-color: rgba(255, 255, 255, 0.7);
            color: #333;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(31, 38, 135, 0.1);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s ease;
        }

        .status-text {
            flex: 1;
            padding: 12px 20px;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.7);
            color: #666;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            box-shadow: 0 4px 16px rgba(31, 38, 135, 0.1);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status-text.error {
            color: #F44336;
        }

        .status-text.warning {
            color: #FFC107;
        }

        .status-text.success {
            color: #4CAF50;
        }

        .action-button:hover {
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
            transform: translateY(-2px);
        }

        /* 图标动画样式 */
        .logo-container {
            position: relative;
            overflow: hidden;
        }

        .logo-container img {
            transition: opacity 0.3s ease;
        }

        .logo-container .icon {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .logo-container .icon.active {
            opacity: 1;
        }

        .logo-container .icon svg {
            width: 100px;
            height: 100px;
        }

        .logo-container .icon.success svg {
            fill: #4CAF50;
        }

        .logo-container .icon.warning svg {
            fill: #FFC107;
        }

        .logo-container .icon.error svg {
            fill: #F44336;
        }

        /* 动画效果 */
        @keyframes checkmark {
            0% {
                stroke-dashoffset: 100;
            }
            100% {
                stroke-dashoffset: 0;
            }
        }

        @keyframes cross {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes warning {
            0% {
                transform: scale(0);
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
            }
        }

        .logo-container .icon.success svg .checkmark {
            animation: checkmark 0.8s ease-in-out forwards;
        }

        .logo-container .icon.error svg .cross {
            animation: cross 0.8s ease-in-out forwards;
        }

        .logo-container .icon.warning svg .warning {
            animation: warning 0.8s ease-in-out forwards;
        }

        /* 验证通过后的容器样式 */
        .side-container {
            position: fixed;
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 15px;
            box-shadow: 0 4px 16px rgba(31, 38, 135, 0.1);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            opacity: 0;
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.5s ease;
            padding: 15px;
            box-sizing: border-box;
            overflow: hidden;
            z-index: 9;
        }

        /* 中间容器样式 */
        .center-container {
            position: fixed;
            top: calc(80px + 10px); /* 顶部容器高度 + 间距 */
            bottom: calc(120px + 10px); /* 底部容器高度 + 间距 */
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 15px;
            box-shadow: 0 4px 16px rgba(31, 38, 135, 0.1);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            opacity: 0;
            transition: opacity 0.5s ease;
            padding: 20px;
            box-sizing: border-box;
            z-index: 8;
            width: calc(100% - 500px);
            margin: 0 auto;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            left: 250px; /* 左侧容器宽度 + 间距 */
            right: 250px; /* 右侧容器宽度 + 间距 */
        }

        /* 导航按钮容器 */
        .navigation-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 0 20px;
            margin-top: 20px;
        }

        /* 导航按钮样式 */
        .nav-button {
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid #ff9800;
            background-color: rgba(255, 255, 255, 0.85);
            color: #ff9800;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(255, 152, 0, 0.2);
            backdrop-filter: blur(4px);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .nav-button:hover {
            background-color: rgba(255, 152, 0, 0.1);
            box-shadow: 0 8px 32px rgba(255, 152, 0, 0.3);
            transform: translateY(-2px);
        }

        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
        }

        .nav-button:disabled:hover {
            transform: none;
        }

        /* 步骤内容容器 */
        .step-content {
            width: 100%;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        /* 接入方式按钮容器 */
        .access-method-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        /* 接入方式按钮 */
        .access-method-button {
            padding: 15px 30px;
            border-radius: 10px;
            border: 2px solid #ff9800;
            background-color: rgba(255, 255, 255, 0.85);
            color: #ff9800;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .access-method-button:hover {
            box-shadow: 0 8px 32px rgba(255, 152, 0, 0.3);
            transform: translateY(-2px);
        }

        .access-method-button.selected {
            background-color: rgba(255, 152, 0, 0.2);
            box-shadow: 0 0 20px rgba(255, 152, 0, 0.5), inset 0 0 10px rgba(255, 152, 0, 0.2);
            border-color: #ff9800;
            color: #ff9800;
        }

        /* 端口选择容器 */
        .port-selection-container {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* 端口选择行 */
        .port-selection-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        /* 端口选择按钮 */
        .port-button {
            padding: 8px 15px;
            border-radius: 8px;
            border: 2px solid #ff9800;
            background-color: rgba(255, 255, 255, 0.85);
            color: #ff9800;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .port-button:hover {
            box-shadow: 0 4px 16px rgba(255, 152, 0, 0.3);
            transform: translateY(-1px);
        }

        .port-button.selected {
            background-color: rgba(255, 152, 0, 0.2);
            box-shadow: 0 0 15px rgba(255, 152, 0, 0.4), inset 0 0 8px rgba(255, 152, 0, 0.2);
            border-color: #ff9800;
            color: #ff9800;
        }

        /* Workers容器样式 */
        .workers-container {
            width: 100%; /* 占满整个父容器宽度 */
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 三列等宽布局 */
            gap: 15px; /* 列间距 */
            padding: 20px; /* 四周内边距 */
            overflow-y: auto;
            box-sizing: border-box; /* 确保padding不会增加总宽度 */
            /* 隐藏滑轨 */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }

        /* 接入地址容器样式 */
        .access-address-container {
            width: 100%; /* 占满整个父容器宽度 */
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 三列等宽布局 */
            gap: 15px; /* 列间距 */
            padding: 20px; /* 四周内边距 */
            overflow-y: auto;
            box-sizing: border-box; /* 确保padding不会增加总宽度 */
            /* 隐藏滑轨 */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }

        /* 代理地址容器样式 */
        .proxy-address-container {
            width: 100%; /* 占满整个父容器宽度 */
            display: grid;
            grid-template-columns: 1fr 1fr; /* 两列布局 */
            gap: 15px; /* 行和列间距 */
            padding: 20px; /* 四周内边距 */
            overflow-y: auto;
            box-sizing: border-box; /* 确保padding不会增加总宽度 */
            /* 隐藏滑轨 */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }

        /* 隐藏滑轨 - Chrome, Safari, Opera */
        .workers-container::-webkit-scrollbar {
            display: none;
        }

        /* Worker项样式 */
        .worker-item {
            padding: 12px 15px;
            border-radius: 8px;
            border: 2px solid #ff9800;
            background-color: rgba(255, 255, 255, 0.85);
            color: #ff9800;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            height: auto; /* 高度自适应内容 */
            min-height: 40px; /* 设置最小高度 */
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .worker-item:hover {
            box-shadow: 0 4px 16px rgba(255, 152, 0, 0.3);
            transform: translateY(-1px);
        }

        .worker-item.selected {
            background-color: rgba(255, 152, 0, 0.2);
            box-shadow: 0 0 15px rgba(255, 152, 0, 0.4), inset 0 0 8px rgba(255, 152, 0, 0.2);
            border-color: #ff9800;
            color: #ff9800;
        }

        /* 接入地址项样式 */
        .access-address-item {
            padding: 12px 15px;
            border-radius: 8px;
            border: 2px solid #ff9800;
            background-color: rgba(255, 255, 255, 0.85);
            color: #ff9800;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            height: auto; /* 高度自适应内容 */
            min-height: 60px; /* 设置最小高度，以容纳主文本和副文本 */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .access-address-item:hover {
            box-shadow: 0 4px 16px rgba(255, 152, 0, 0.3);
            transform: translateY(-1px);
        }

        .access-address-item.selected {
            background-color: rgba(255, 152, 0, 0.2);
            box-shadow: 0 0 15px rgba(255, 152, 0, 0.4), inset 0 0 8px rgba(255, 152, 0, 0.2);
            border-color: #ff9800;
            color: #ff9800;
        }

        .access-address-main-text {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
            word-break: break-all;
        }

        .access-address-sub-text {
            font-size: 12px;
            color: #888;
            word-break: break-all;
        }

        /* 代理地址项样式 */
        .proxy-address-item {
            padding: 8px 12px;
            border-radius: 8px;
            border: 2px solid #ff9800;
            background-color: rgba(255, 255, 255, 0.85);
            color: #ff9800;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            height: auto; /* 高度自适应内容 */
            min-height: 60px; /* 减少最小高度 */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: break-all; /* 确保长文本可以换行 */
        }

        .proxy-address-item:hover {
            box-shadow: 0 4px 16px rgba(255, 152, 0, 0.3);
            transform: translateY(-1px);
        }

        .proxy-address-item.selected {
            background-color: rgba(255, 152, 0, 0.2);
            box-shadow: 0 0 15px rgba(255, 152, 0, 0.4), inset 0 0 8px rgba(255, 152, 0, 0.2);
            border-color: #ff9800;
            color: #ff9800;
        }

        .proxy-address-main-text {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
            word-break: break-all;
        }

        .proxy-address-sub-text {
            font-size: 12px;
            color: #888;
            word-break: break-all;
        }

        /* 代理代码筛选按钮样式 */
        .code-filter-button {
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid #ff9800;
            background-color: rgba(255, 255, 255, 0.85);
            color: #ff9800;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .code-filter-button:hover {
            background-color: rgba(255, 152, 0, 0.1);
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.2);
        }

        .code-filter-button.selected {
            background-color: rgba(255, 152, 0, 0.2);
            box-shadow: 0 0 10px rgba(255, 152, 0, 0.3);
            color: #ff9800;
        }

        /* 选择列表样式 */
        .selection-list {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
        }

        .selection-item {
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 10px;
            border: 2px solid #ff9800;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .selection-item:hover {
            box-shadow: 0 8px 32px rgba(255, 152, 0, 0.3);
            transform: translateY(-2px);
        }

        .selection-item .main-text {
            font-size: 16px;
            font-weight: 500;
            color: #333;
        }

        .selection-item .sub-text {
            font-size: 14px;
            color: #888;
        }

        /* 端口选择样式 */
        .port-selection {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 10px;
        }

        .port-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .port-group-title {
            font-size: 16px;
            font-weight: 500;
            color: #333;
        }

        .port-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .port-option {
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 10px;
            border: 2px solid #ff9800;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .port-option:hover {
            box-shadow: 0 8px 32px rgba(255, 152, 0, 0.3);
            transform: translateY(-2px);
        }

        .port-option.selected {
            background-color: rgba(255, 152, 0, 0.2);
        }

        /* 代理方式选择样式 */
        .proxy-method-container {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .proxy-method-button {
            padding: 15px 30px;
            border-radius: 10px;
            border: 2px solid #ff9800;
            background-color: rgba(255, 255, 255, 0.85);
            color: #ff9800;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .proxy-method-button:hover {
            box-shadow: 0 8px 32px rgba(255, 152, 0, 0.3);
            transform: translateY(-2px);
        }

        .proxy-method-button.selected {
            background-color: rgba(255, 152, 0, 0.2);
        }

        .center-container.active {
            opacity: 1;
        }

        /* 隐藏滚动条 */
        .center-container::-webkit-scrollbar {
            display: none;
        }
        .center-container {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .left-container {
            left: 20px;
            transform: translateX(-100%);
            top: 20px;
            bottom: 20px;
            width: 210px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .right-container {
            right: 20px;
            transform: translateX(100%);
            top: 20px;
            bottom: 20px;
            width: 210px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .side-container.active {
            opacity: 1;
        }

        .left-container.active {
            transform: translateX(0);
        }

        .right-container.active {
            transform: translateX(0);
        }

        /* 面板标题 */
        .panel-title {
            font-weight: bold;
            margin-bottom: 16px;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        /* 面板内容区域 */
        .panel-content {
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto;
            max-height: calc(100% - 40px);
            padding: 5px;
            justify-content: space-between;
            flex: 1;
        }

        /* 子容器样式 */
        .sub-container {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            flex: 1;
            min-height: 80px;
        }

        .sub-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        /* 步骤序号 */
        .step-number {
            position: absolute;
            top: 8px;
            left: 8px;
            font-size: 12px;
            color: #666;
            font-weight: normal;
        }

        /* 步骤标题 */
        .step-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
            text-align: center;
        }

        /* 步骤说明 */
        .step-desc {
            font-size: 14px;
            color: #888;
            text-align: center;
        }

        .panel-content::-webkit-scrollbar {
            display: none;
        }
        .panel-content {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* 固定项容器样式 */
        .fixed-items-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
        }

        /* 固定项样式 */
        .panel-fixed-item {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 40px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .panel-fixed-item:hover {
            background-color: rgba(255, 255, 255, 0.95);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        /* 展开容器动画 */
        .side-container.left-container.expanded {
            width: calc(200px + 20px + 200px);
            z-index: 10;
        }

        /* 列表项样式 */
        .panel-item {
            background-color: rgba(255, 255, 255, 0.85);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 40px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .panel-item:hover {
            background-color: rgba(255, 255, 255, 0.95);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        /* 下拉选择框样式 */
        .select-container {
            position: relative;
            width: 100%;
        }

        .select-button {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 10px;
            padding: 10px 15px;
            font-size: 14px;
            text-align: left;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .select-button:after {
            content: "▼";
            font-size: 12px;
        }

        .select-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            z-index: 10;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .select-options.active {
            display: block;
        }

        .select-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .select-option:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .select-option:first-child {
            border-radius: 10px 10px 0 0;
        }

        .select-option:last-child {
            border-radius: 0 0 10px 10px;
        }

        /* 移除按钮样式 */
        .remove-button {
            background: none;
            border: none;
            color: #ff5252;
            font-size: 16px;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .remove-button:hover {
            background-color: rgba(255, 82, 82, 0.1);
        }

        .logo-container.fade-out {
            opacity: 0;
            transition: opacity 1s ease;
        }

        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            flex-grow: 1;
        }

        .logo-container {
            width: 200px;
            height: 200px;
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .logo-container img {
            width: 150px;
            height: 150px;
            object-fit: contain;
        }

        .info-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 1200px;
            gap: 20px;
            margin-top: 20px;
        }

        .info-card {
            flex: 1;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(31, 38, 135, 0.1);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s ease;
        }

        .info-card:hover {
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
            transform: translateY(-5px);
        }

        .info-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .info-ip {
            font-size: 16px;
            font-weight: 500;
            color: #444;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        @media (max-width: 768px) {
            .info-container {
                flex-direction: column;
            }

            .input-button-container {
                flex-direction: column;
                gap: 20px;
            }

            .uuid-input {
                width: 100%;
            }

            .action-button {
                width: 100%;
            }

            .logo-container {
                width: 150px;
                height: 150px;
            }

            .logo-container img {
                width: 100px;
                height: 100px;
            }

            /* 在小屏幕上代理地址列表恢复为单列布局 */
            .proxy-address-container {
                grid-template-columns: 1fr;
            }
        }

        /* 配置容器样式 */
        .config-container {
            width: 90%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="top-container">
        <div class="input-button-container">
            <div class="status-text" id="status-text">UUID未载入</div>
            <input type="text" class="uuid-input" id="uuid-input" placeholder="请输入UUID">
            <button class="action-button" id="verify-btn">验证UUID</button>
        </div>
    </div>

    <div class="main-container">
        <div class="logo-container" id="logo-container">
            <img src="static/logo.png" alt="Logo" id="logo-img">
            <div class="icon success" id="success-icon">
                <svg viewBox="0 0 24 24">
                    <path class="checkmark" fill="none" stroke="#4CAF50" stroke-width="2" d="M5 12l5 5L20 7" stroke-dasharray="100" stroke-dashoffset="100"/>
                </svg>
            </div>
            <div class="icon warning" id="warning-icon">
                <svg viewBox="0 0 24 24">
                    <path class="warning" d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                </svg>
            </div>
            <div class="icon error" id="error-icon">
                <svg viewBox="0 0 24 24">
                    <g class="cross">
                        <line x1="6" y1="6" x2="18" y2="18" stroke="#F44336" stroke-width="2" stroke-linecap="round"/>
                        <line x1="18" y1="6" x2="6" y2="18" stroke="#F44336" stroke-width="2" stroke-linecap="round"/>
                    </g>
                </svg>
            </div>
        </div>

        <!-- 左侧容器 -->
        <div class="side-container left-container" id="left-container">
            <div class="panel-title">配置流程</div>
            <div class="panel-content">
                <!-- 初始步 -->
                <div class="sub-container">
                    <div class="step-number">初始步</div>
                    <div class="step-title">Railgun</div>
                    <div class="step-desc">欢迎使用 Railgun</div>
                </div>
                <!-- 6个子容器 -->
                <div class="sub-container">
                    <div class="step-number">第一步</div>
                    <div class="step-title">接入方式</div>
                    <div class="step-desc">接入路由的连接方式</div>
                </div>
                <div class="sub-container">
                    <div class="step-number">第二步</div>
                    <div class="step-title">接入地址</div>
                    <div class="step-desc">接入路由的服务地址</div>
                </div>
                <div class="sub-container">
                    <div class="step-number">第三步</div>
                    <div class="step-title">接入协议</div>
                    <div class="step-desc">接入路由的地址端口</div>
                </div>
                <div class="sub-container">
                    <div class="step-number">第四步</div>
                    <div class="step-title">路由地址</div>
                    <div class="step-desc">负责转发的路由地址</div>
                </div>
                <div class="sub-container">
                    <div class="step-number">第五步</div>
                    <div class="step-title">代理方式</div>
                    <div class="step-desc">访问CDN的代理方式</div>
                </div>
                <div class="sub-container">
                    <div class="step-number">第六步</div>
                    <div class="step-title">代理地址</div>
                    <div class="step-desc">访问CDN的代理节点</div>
                </div>
                <!-- 最终步 -->
                <div class="sub-container">
                    <div class="step-number">最终步</div>
                    <div class="step-title">导出配置</div>
                    <div class="step-desc">导出配置后的结果</div>
                </div>
            </div>
        </div>

        <!-- 右侧容器 -->
        <div class="side-container right-container" id="right-container">
            <div class="panel-title">配置选项</div>
            <div class="panel-content">
                <!-- 6个列表选项按钮 -->
                <div class="panel-fixed-item" id="config-access-method">接入方式</div>
                <div class="panel-fixed-item" id="config-access-address">接入地址</div>
                <div class="panel-fixed-item" id="config-access-protocol">接入协议</div>
                <div class="panel-fixed-item" id="config-route-address">路由地址</div>
                <div class="panel-fixed-item" id="config-proxy-method">代理方式</div>
                <div class="panel-fixed-item" id="config-proxy-address">代理地址</div>

                <!-- 分割线 -->
                <div style="border-bottom: 1px solid rgba(0,0,0,0.1); margin: 10px 0;"></div>

                <!-- 功能按钮 -->
                <div class="panel-fixed-item" id="export-config">生成配置</div>
                <div class="panel-fixed-item" id="clear-config">清空配置</div>

                <!-- 分割线 -->
                <div style="border-bottom: 1px solid rgba(0,0,0,0.1); margin: 10px 0;"></div>

                <div class="panel-fixed-item" id="about-service">关于服务</div>

                <!-- 分割线 -->
                <div style="border-bottom: 1px solid rgba(0,0,0,0.1); margin: 10px 0;"></div>

                <!-- 填补剩余空间的容器 -->
                <div class="remaining-space" style="flex: 1; background-color: white; border-radius: 10px; overflow: hidden; position: relative;">
                    <img src="static/img.jpg" alt="Railgun" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;">
                </div>
            </div>
        </div>

        <!-- 中间容器 -->
        <div class="center-container" id="center-container">
            <div class="step-content" id="step-content">
                <!-- 初始内容 -->
                <div id="welcome-step" style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
                    <h2 style="color: #ff9800; margin-bottom: 20px; text-align: center; font-size: 32px;">Railgun</h2>
                    <p style="text-align: center; line-height: 1.6; color: #888; font-size: 12px;">
                        Railgun 是一个基于 CDN 与 边缘计算 的网络加速服务
                    </p>
                </div>

                <!-- 接入方式选择 -->
                <div id="access-method-step" style="display: none; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
                    <div class="access-method-container">
                        <button class="access-method-button" id="domain-btn" data-type="domain">
                            <span>域名</span>
                            <span style="font-size: 12px; color: #888;">cdndomain</span>
                        </button>
                        <button class="access-method-button" id="ip-btn" data-type="ip">
                            <span>IP</span>
                            <span style="font-size: 12px; color: #888;">cdnip</span>
                        </button>
                    </div>
                </div>

                <!-- 接入协议选择 -->
                <div id="access-protocol-step" style="display: none; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
                    <div class="port-selection-container">
                        <div class="port-selection-row">
                            <span style="margin-right: 10px; font-weight: 500;">HTTPS：</span>
                            <button class="port-button" data-protocol="https" data-port="443">443</button>
                            <button class="port-button" data-protocol="https" data-port="2053">2053</button>
                            <button class="port-button" data-protocol="https" data-port="2083">2083</button>
                            <button class="port-button" data-protocol="https" data-port="2087">2087</button>
                            <button class="port-button" data-protocol="https" data-port="2096">2096</button>
                            <button class="port-button" data-protocol="https" data-port="8443">8443</button>
                        </div>
                        <div class="port-selection-row">
                            <span style="margin-right: 10px; font-weight: 500;">HTTP：</span>
                            <button class="port-button" data-protocol="http" data-port="80">80</button>
                            <button class="port-button" data-protocol="http" data-port="8080">8080</button>
                            <button class="port-button" data-protocol="http" data-port="8880">8880</button>
                            <button class="port-button" data-protocol="http" data-port="2052">2052</button>
                            <button class="port-button" data-protocol="http" data-port="2082">2082</button>
                            <button class="port-button" data-protocol="http" data-port="2086">2086</button>
                            <button class="port-button" data-protocol="http" data-port="2095">2095</button>
                        </div>
                    </div>
                </div>

                <!-- 代理方式选择 -->
                <div id="proxy-method-step" style="display: none; flex-direction: column; justify-content: center; align-items: center; height: 100%;">
                    <div class="access-method-container">
                        <button class="access-method-button" id="proxyip-btn" data-method="proxyip">
                            <span>ProxyIP</span>
                            <span style="font-size: 12px; color: #888;">IP代理</span>
                        </button>
                        <button class="access-method-button" id="proxygroup-btn" data-method="proxygroup">
                            <span>Proxy IP Group</span>
                            <span style="font-size: 12px; color: #888;">IP代理地区组</span>
                        </button>
                    </div>
                </div>

                <!-- 接入地址选择 -->
                <div id="access-address-step" style="display: none; flex-direction: column; justify-content: center; align-items: center; height: 100%; width: 100%;">
                    <div class="access-address-container" id="access-address-container">
                        <!-- 接入地址列表将通过JavaScript动态加载 -->
                    </div>
                </div>

                <!-- 代理地址选择 -->
                <div id="proxy-address-step" style="display: none; flex-direction: column; justify-content: center; align-items: center; height: 100%; width: 100%; overflow-y: auto;">
                    <div class="proxy-code-filter-container" id="proxy-code-filter-container" style="display: none; flex-wrap: wrap; gap: 10px; margin: 15px 0; justify-content: center;">
                        <!-- 代理代码筛选按钮将通过JavaScript动态加载 -->
                    </div>
                    <div class="proxy-address-container" id="proxy-address-container">
                        <!-- 代理地址列表将通过JavaScript动态加载 -->
                    </div>
                </div>

                <!-- 路由地址选择 -->
                <div id="route-address-step" style="display: none; flex-direction: column; justify-content: center; align-items: center; height: 100%; width: 100%;">
                    <div class="workers-container" id="workers-container">
                        <!-- Workers列表将通过JavaScript动态加载 -->
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <div class="info-container">
        <div class="info-card">
            <div class="info-title">国内测试（speedtest）</div>
            <div class="info-ip" id="speedtest-ip">加载中...</div>
        </div>

        <div class="info-card">
            <div class="info-title">国外测试（漏网之鱼）</div>
            <div class="info-ip" id="ipapi-ip">加载中...</div>
        </div>

        <div class="info-card">
            <div class="info-title">CloudFlare（ProxyIP）</div>
            <div class="info-ip" id="cf-ip">加载中...</div>
        </div>

        <div class="info-card">
            <div class="info-title">海外测试（推特）</div>
            <div class="info-ip" id="twitter-ip">加载中...</div>
        </div>
    </div>
    <script>
        // 获取Speedtest IP
        fetch('https://api-v3.speedtest.cn/ip')
            .then(response => response.json())
            .then(data => {
                document.getElementById('speedtest-ip').textContent = 
                    `${data.data.ip} & ${data.data.country}`;
            })
            .catch(error => {
                document.getElementById('speedtest-ip').textContent = '获取失败';
            });

        // 获取IPAPI IP
        fetch('https://api.ipapi.cmliussss.net')
            .then(response => response.json())
            .then(data => {
                document.getElementById('ipapi-ip').textContent = 
                    `${data.ip} & ${data.datacenter.country}`;
            })
            .catch(error => {
                document.getElementById('ipapi-ip').textContent = '获取失败';
            });

        // 获取CloudFlare IP
        fetch('https://cf.090227.xyz/ip.json')
            .then(response => response.json())
            .then(data => {
                document.getElementById('cf-ip').textContent = 
                    `${data.ip} & ${data.country}`;
            })
            .catch(error => {
                document.getElementById('cf-ip').textContent = '获取失败';
            });

        // 获取Twitter IP
        fetch('https://x.com/cdn-cgi/trace')
            .then(response => response.text())
            .then(data => {
                const lines = data.split('\n');
                let ip = '';
                let colo = '';

                for (const line of lines) {
                    if (line.startsWith('ip=')) {
                        ip = line.substring(3);
                    } else if (line.startsWith('colo=')) {
                        colo = line.substring(5);
                    }
                }

                document.getElementById('twitter-ip').textContent = 
                    `${ip} & ${colo}`;
            })
            .catch(error => {
                document.getElementById('twitter-ip').textContent = '获取失败';
            });

        // 加载代理IP地址函数
        function loadProxyIPAddresses() {
            const addressContainer = document.getElementById('proxy-address-container');
            const codeFilterContainer = document.getElementById('proxy-code-filter-container');
            addressContainer.innerHTML = ''; // 清空容器
            codeFilterContainer.innerHTML = ''; // 清空code筛选按钮容器

            // 检查是否正在加载中
            if (window.proxyDataLoading) {
                return;
            }

            // 设置加载状态
            window.proxyDataLoading = true;

            // 获取当前UUID
            const currentUUID = document.getElementById('uuid-input').value;

            // 从API获取代理IP数据
            fetch(`/api/auth?uuid=${currentUUID}&get_proxyip=true`)
                .then(response => {
                    if (!response.ok) {
                        console.error('获取代理IP数据失败');
                    }
                    return response.json();
                })
                .then(data => {
                    // 存储原始数据
                    window.proxyData = data;

                    // 清除加载状态
                    window.proxyDataLoading = false;

                    // 提取所有唯一的code值
                    const uniqueCodes = [...new Set(data.map(item => item.code))];

                    // 创建code筛选按钮
                    uniqueCodes.forEach(code => {
                        const codeButton = document.createElement('button');
                        codeButton.className = 'code-filter-button';
                        codeButton.dataset.code = code;
                        codeButton.textContent = code;

                        // 添加点击事件
                        codeButton.addEventListener('click', function() {
                            // 移除所有按钮的选中状态
                            document.querySelectorAll('.code-filter-button').forEach(btn => {
                                btn.classList.remove('selected');
                            });

                            // 只选中当前点击的按钮
                            this.classList.add('selected');

                            // 获取选中的code
                            const selectedCodes = [this.dataset.code];

                            // 保存选中的code到localStorage
                            localStorage.setItem('selectedProxyCodes', JSON.stringify(selectedCodes));

                            // 筛选代理地址
                            filterProxyAddresses(selectedCodes);
                        });

                        codeFilterContainer.appendChild(codeButton);
                    });

                    // 恢复code筛选状态
                    restoreCodeFilterState();
                })
                .catch(error => {
                    console.error('加载代理IP地址失败:', error);
                    // 清除加载状态
                    window.proxyDataLoading = false;
                    // 不显示错误提示，保持容器为空
                });
        }

        // 恢复code筛选状态函数
        function restoreCodeFilterState() {
            // 从localStorage获取之前选中的code
            const savedCodes = localStorage.getItem('selectedProxyCodes');
            let selectedCodes = [];

            if (savedCodes) {
                try {
                    selectedCodes = JSON.parse(savedCodes);
                } catch (e) {
                    console.error('解析选中的code失败:', e);
                }
            }

            // 如果有选中的code，恢复按钮选中状态
            if (selectedCodes.length > 0) {
                document.querySelectorAll('.code-filter-button').forEach(btn => {
                    if (selectedCodes.includes(btn.dataset.code)) {
                        btn.classList.add('selected');
                    }
                });

                // 根据选中的code筛选代理地址
                filterProxyAddresses(selectedCodes);
            } else {
                // 没有选中的code，显示所有代理地址
                renderProxyAddresses(window.proxyData);
            }
        }

        // 筛选代理地址函数
        function filterProxyAddresses(selectedCodes) {
            // 如果没有选中任何code，显示所有地址
            if (selectedCodes.length === 0) {
                renderProxyAddresses(window.proxyData);
                return;
            }

            // 筛选出符合选中code的地址
            const filteredData = window.proxyData.filter(item => 
                selectedCodes.includes(item.code)
            );

            // 渲染筛选后的地址
            renderProxyAddresses(filteredData);
        }

        // 渲染代理地址函数
        function renderProxyAddresses(data) {
            const addressContainer = document.getElementById('proxy-address-container');
            const codeFilterContainer = document.getElementById('proxy-code-filter-container');
            addressContainer.innerHTML = ''; // 清空容器
            codeFilterContainer.style.display = 'none'; // 默认隐藏code筛选按钮容器

            // 添加加载更多按钮
            const loadMoreButton = document.createElement('div');
            loadMoreButton.className = 'load-more-button';
            loadMoreButton.textContent = '加载更多';
            loadMoreButton.style.cssText = `
                text-align: center;
                padding: 10px;
                margin: 10px 0;
                background-color: rgba(255, 152, 0, 0.1);
                border: 1px solid #ff9800;
                border-radius: 5px;
                cursor: pointer;
                color: #ff9800;
                font-weight: 500;
                transition: all 0.2s ease;
            `;

            // 初始显示数量
            const initialCount = 19;
            let currentIndex = 0;

            // 懒加载函数
            function loadMoreItems() {
                const endIndex = Math.min(currentIndex + initialCount, data.length);

                for (let i = currentIndex; i < endIndex; i++) {
                    const item = data[i];
                    const addressItem = document.createElement('div');
                    addressItem.className = 'proxy-address-item';
                    addressItem.dataset.address = `${item.ip}:${item.port}`;

                    // 创建主文本和副文本
                    const mainText = document.createElement('div');
                    mainText.className = 'proxy-address-main-text';
                    mainText.textContent = `${item.ip}:${item.port}`;

                    const subText = document.createElement('div');
                    subText.className = 'proxy-address-sub-text';
                    subText.textContent = `${item.code} & ${item.asn}`;

                    addressItem.appendChild(mainText);
                    addressItem.appendChild(subText);

                    // 添加点击事件
                    addressItem.addEventListener('click', function() {
                        // 移除所有地址项的选中状态
                        document.querySelectorAll('.proxy-address-item').forEach(item => {
                            item.classList.remove('selected');
                        });
                        // 添加当前项的选中状态
                        addressItem.classList.add('selected');

                        // 保存用户选择的代理地址
                        window.userSelections.proxySelection = `${item.ip}:${item.port}`;

                        // 保存到localStorage
                        localStorage.setItem('userSelections', JSON.stringify(window.userSelections));

                        // 在左侧第六步子容器右上角显示选择状态
                        window.updateLeftStepStatus(6, '已配置');
                    });

                    addressContainer.appendChild(addressItem);
                }

                currentIndex = endIndex;

                // 移除现有的加载更多按钮（如果存在）
                const existingButton = addressContainer.querySelector('.load-more-button');
                if (existingButton) {
                    addressContainer.removeChild(existingButton);
                }

                // 如果还有更多数据，添加加载更多按钮到列表末尾
                if (currentIndex < data.length) {
                    addressContainer.appendChild(loadMoreButton);
                }
            }

            // 添加加载更多按钮点击事件
            loadMoreButton.addEventListener('click', loadMoreItems);

            // 添加鼠标悬停效果
            loadMoreButton.addEventListener('mouseenter', function() {
                this.style.backgroundColor = 'rgba(255, 152, 0, 0.2)';
            });

            loadMoreButton.addEventListener('mouseleave', function() {
                this.style.backgroundColor = 'rgba(255, 152, 0, 0.1)';
            });

            // 如果有数据，显示code筛选按钮容器
            if (data.length > 0) {
                codeFilterContainer.style.display = 'flex';
            }

            // 初始加载一批数据
            loadMoreItems();
        }

        // 更新左侧步骤状态
        window.updateLeftStepStatus = function(stepNumber, statusText) {
            const leftSubContainers = document.querySelectorAll('.left-container .sub-container');
            if (leftSubContainers[stepNumber]) {
                // 检查是否已存在状态文本
                let statusElement = leftSubContainers[stepNumber].querySelector('.step-status');
                if (!statusElement) {
                    // 创建状态文本元素
                    statusElement = document.createElement('div');
                    statusElement.className = 'step-status';
                    statusElement.style.position = 'absolute';
                    statusElement.style.top = '8px';
                    statusElement.style.right = '8px';
                    statusElement.style.fontSize = '12px';
                    statusElement.style.color = '#ff9800';
                    statusElement.style.fontWeight = 'normal';
                    leftSubContainers[stepNumber].appendChild(statusElement);
                }
                // 更新状态文本
                statusElement.textContent = statusText;
            }
        }

        // 加载域名地址函数
        window.loadDomainAddresses = function() {
            const addressContainer = document.getElementById('access-address-container');
            addressContainer.innerHTML = ''; // 清空容器

            // 获取当前UUID
            const currentUUID = document.getElementById('uuid-input').value;

            // 从API获取域名数据
            fetch(`/api/auth?uuid=${currentUUID}&get_cdndomain=true`)
                .then(response => {
                    if (!response.ok) {
                        console.error('获取域名数据失败');
                    }
                    return response.json();
                })
                .then(data => {
                    // 创建域名地址项
                    data.forEach(item => {
                        const addressItem = document.createElement('div');
                        addressItem.className = 'access-address-item';
                        addressItem.dataset.address = item.domain;

                        // 创建主文本和副文本
                        const mainText = document.createElement('div');
                        mainText.className = 'access-address-main-text';
                        mainText.textContent = item.domain;

                        const subText = document.createElement('div');
                        subText.className = 'access-address-sub-text';
                        subText.textContent = item.option || '';

                        addressItem.appendChild(mainText);
                        if (item.option) {
                            addressItem.appendChild(subText);
                        }

                        // 添加点击事件
                        addressItem.addEventListener('click', function() {
                            // 移除所有地址项的选中状态
                            document.querySelectorAll('.access-address-item').forEach(item => {
                                item.classList.remove('selected');
                            });
                            // 添加当前项的选中状态
                            addressItem.classList.add('selected');

                            // 保存用户选择的接入地址
                            window.userSelections.accessSelection = item.domain;

                            // 保存到localStorage
                            localStorage.setItem('userSelections', JSON.stringify(window.userSelections));

                            // 在左侧第二步子容器右上角显示选择状态
                            window.updateLeftStepStatus(2, '已配置');
                        });

                        addressContainer.appendChild(addressItem);
                    });
                })
                .catch(error => {
                    console.error('加载域名地址失败:', error);
                    // 不显示错误提示，保持容器为空
                });
        }

        // 加载workers数据函数
        window.loadWorkers = function() {
            const workersContainer = document.getElementById('workers-container');
            workersContainer.innerHTML = ''; // 清空容器

            // 获取当前UUID
            const currentUUID = document.getElementById('uuid-input').value;

            // 从API获取workers数据
            fetch(`/api/auth?uuid=${currentUUID}&get_workers=true`)
                .then(response => {
                    if (!response.ok) {
                        console.error('获取workers数据失败');
                    }
                    return response.json();
                })
                .then(data => {
                    // 创建worker项
                    data.forEach(item => {
                        const workerItem = document.createElement('div');
                        workerItem.className = 'worker-item';
                        workerItem.dataset.worker = item.workers;
                        workerItem.textContent = item.workers;

                        // 添加点击事件
                        workerItem.addEventListener('click', function() {
                            // 移除所有worker项的选中状态
                            document.querySelectorAll('.worker-item').forEach(item => {
                                item.classList.remove('selected');
                            });
                            // 添加当前项的选中状态
                            workerItem.classList.add('selected');

                            // 保存用户选择的worker
                            window.userSelections.worker = item.workers;

                            // 保存到localStorage
                            localStorage.setItem('userSelections', JSON.stringify(window.userSelections));

                            // 在左侧第四步子容器右上角显示选择状态
                            window.updateLeftStepStatus(4, '已配置');
                        });

                        workersContainer.appendChild(workerItem);
                    });
                })
                .catch(error => {
                    console.error('加载workers数据失败:', error);
                    // 不显示错误提示，保持容器为空
                });
        }

        // 加载IP地址函数
        window.loadIPAddresses = function() {
            const addressContainer = document.getElementById('access-address-container');
            addressContainer.innerHTML = ''; // 清空容器

            // 获取当前UUID
            const currentUUID = document.getElementById('uuid-input').value;

            // 从API获取IP数据
            fetch(`/api/auth?uuid=${currentUUID}&get_cdnip=true`)
                .then(response => {
                    if (!response.ok) {
                        console.error('获取IP数据失败');
                    }
                    return response.json();
                })
                .then(data => {
                    // 创建IP地址项
                    data.forEach(item => {
                        const addressItem = document.createElement('div');
                        addressItem.className = 'access-address-item';
                        addressItem.dataset.address = item.ip;

                        // 创建主文本和副文本
                        const mainText = document.createElement('div');
                        mainText.className = 'access-address-main-text';
                        mainText.textContent = item.ip;

                        const subText = document.createElement('div');
                        subText.className = 'access-address-sub-text';
                        subText.textContent = `${item.country} - ${item.regionName} - ${item.city}`;

                        addressItem.appendChild(mainText);
                        addressItem.appendChild(subText);

                        // 添加点击事件
                        addressItem.addEventListener('click', function() {
                            // 移除所有地址项的选中状态
                            document.querySelectorAll('.access-address-item').forEach(item => {
                                item.classList.remove('selected');
                            });
                            // 添加当前项的选中状态
                            addressItem.classList.add('selected');

                            // 保存用户选择的接入地址
                            window.userSelections.accessSelection = item.ip;

                            // 保存到localStorage
                            localStorage.setItem('userSelections', JSON.stringify(window.userSelections));

                            // 在左侧第二步子容器右上角显示选择状态
                            window.updateLeftStepStatus(2, '已配置');
                        });

                        addressContainer.appendChild(addressItem);
                    });
                })
                .catch(error => {
                    console.error('加载IP地址失败:', error);
                    // 不显示错误提示，保持容器为空
                });
        }

        // 页面加载时检查登录状态
        window.addEventListener('load', function() {
            checkLoginStatus();
            // 如果已经登录，不需要在这里初始化步骤导航，因为它会在showIcon函数中调用

            // 从localStorage恢复用户选择
            const savedSelections = localStorage.getItem('userSelections');
            if (savedSelections) {
                try {
                    window.userSelections = JSON.parse(savedSelections);
                    // 基于localStorage中的记录恢复左侧列的已配置提示
                    window.updateLeftStepStatus(1, window.userSelections.accessMethod ? '已配置' : '');
                    window.updateLeftStepStatus(2, window.userSelections.accessSelection ? '已配置' : '');
                    window.updateLeftStepStatus(3, window.userSelections.port ? '已配置' : '');
                    window.updateLeftStepStatus(4, window.userSelections.worker ? '已配置' : '');
                    window.updateLeftStepStatus(5, window.userSelections.proxyMethod ? '已配置' : '');
                    window.updateLeftStepStatus(6, window.userSelections.proxySelection ? '已配置' : '');
                } catch (e) {
                    console.error('恢复用户选择失败:', e);
                    // 初始化用户选择对象
                    window.userSelections = {
                        accessMethod: null,  // 'domain' 或 'ip'
                        accessSelection: null,  // 选择的域名或IP
                        protocol: null,  // 选择的协议 'http' 或 'https'
                        port: null,  // 选择的端口
                        worker: null,  // 选择的worker
                        proxyMethod: null,  // 'proxyip', 'proxygroup'
                        proxySelection: null  // 选择的代理
                    };
                }
            } else {
                // 初始化用户选择对象
                window.userSelections = {
                    accessMethod: null,  // 'domain' 或 'ip'
                    accessSelection: null,  // 选择的域名或IP
                    port: null,  // 选择的端口
                    worker: null,  // 选择的worker
                    proxyMethod: null,  // 'proxyip', 'proxygroup'
                    proxySelection: null  // 选择的代理
                };
            }

            // 添加接入方式按钮点击事件
            const accessMethodBtn = document.getElementById('config-access-method');
            if (accessMethodBtn) {
                accessMethodBtn.addEventListener('click', function() {
                    // 隐藏所有步骤内容
                    document.querySelectorAll('[id$="-step"]').forEach(el => {
                        el.style.display = 'none';
                    });
                    // 显示接入方式选择页
                    document.getElementById('access-method-step').style.display = 'flex';

                    // 从localStorage获取最新的用户选择
                    const savedSelections = localStorage.getItem('userSelections');
                    if (savedSelections) {
                        try {
                            window.userSelections = JSON.parse(savedSelections);
                        } catch (e) {
                            console.error('解析用户选择失败:', e);
                        }
                    }

                    // 如果已选择接入方式，恢复按钮选中状态
                    if (window.userSelections.accessMethod === 'domain') {
                        document.getElementById('domain-btn').classList.add('selected');
                        document.getElementById('ip-btn').classList.remove('selected');
                    } else if (window.userSelections.accessMethod === 'ip') {
                        document.getElementById('ip-btn').classList.add('selected');
                        document.getElementById('domain-btn').classList.remove('selected');
                    }

                    // 如果已选择接入方式，恢复左侧列的已配置提示
                    if (window.userSelections.accessMethod) {
                        window.updateLeftStepStatus(1, '已配置');
                    }

                    // 如果已选择端口，恢复左侧列的已配置提示
                    if (window.userSelections.port) {
                        window.updateLeftStepStatus(3, '已配置');
                    }
                });
            }

            // 添加其他配置按钮点击事件
            const configButtons = [
                'config-access-address',
                'config-access-protocol',
                'config-route-address',
                'config-proxy-method',
                'config-proxy-address'
            ];

            configButtons.forEach(buttonId => {
                const button = document.getElementById(buttonId);
                if (button) {
                    button.addEventListener('click', function() {
                        // 从localStorage获取最新的用户选择
                        const savedSelections = localStorage.getItem('userSelections');
                        if (savedSelections) {
                            try {
                                window.userSelections = JSON.parse(savedSelections);
                            } catch (e) {
                                console.error('解析用户选择失败:', e);
                            }
                        }

                        // 隐藏所有步骤内容
                        document.querySelectorAll('[id$="-step"]').forEach(el => {
                            el.style.display = 'none';
                        });

                        // 如果是接入协议按钮，显示接入协议选择页
                        if (buttonId === 'config-access-protocol') {
                            document.getElementById('access-protocol-step').style.display = 'flex';

                            // 如果已选择端口，恢复按钮选中状态
                            if (window.userSelections.port) {
                                document.querySelectorAll('.port-button').forEach(btn => {
                                    btn.classList.remove('selected');
                                    if (btn.dataset.port === window.userSelections.port) {
                                        btn.classList.add('selected');
                                    }
                                });
                            }
                        } 
                        // 如果是代理方式按钮，显示代理方式选择页
                        else if (buttonId === 'config-proxy-method') {
                            document.getElementById('proxy-method-step').style.display = 'flex';

                            // 如果已选择代理方式，恢复按钮选中状态
                            if (window.userSelections.proxyMethod) {
                                document.querySelectorAll('#proxyip-btn, #proxygroup-btn').forEach(btn => {
                                    btn.classList.remove('selected');
                                    if (btn.dataset.method === window.userSelections.proxyMethod) {
                                        btn.classList.add('selected');
                                    }
                                });
                            }
                        }
                        // 如果是接入地址按钮，显示接入地址选择页
                        else if (buttonId === 'config-access-address') {
                            document.getElementById('access-address-step').style.display = 'flex';

                            // 检查是否已配置接入方式
                            if (!window.userSelections.accessMethod) {
                                // 显示提示信息
                                const addressContainer = document.getElementById('access-address-container');
                                addressContainer.innerHTML = ''; // 保持空白
                            } else {
                                // 如果已选择接入地址，恢复选中状态
                                if (window.userSelections.accessSelection) {
                                    // 使用更长的延迟确保地址已加载
                                    setTimeout(() => {
                                        const items = document.querySelectorAll('.access-address-item');
                                        items.forEach(item => {
                                            item.classList.remove('selected');
                                            if (item.dataset.address === window.userSelections.accessSelection) {
                                                item.classList.add('selected');
                                            }
                                        });
                                    }, 1000); // 增加延迟时间到1000ms
                                }
                            }
                        }
                        // 如果是代理地址按钮，显示代理地址选择页
                        else if (buttonId === 'config-proxy-address') {
                            document.getElementById('proxy-address-step').style.display = 'flex';

                            // 检查是否已配置代理方式
                            if (!window.userSelections.proxyMethod) {
                                // 显示提示信息
                                const addressContainer = document.getElementById('proxy-address-container');
                                addressContainer.innerHTML = ''; // 保持空白
                            } else {
                                // 根据代理方式加载不同的数据
                                if (window.userSelections.proxyMethod === 'proxyip') {
                                    loadProxyIPAddresses();
                                } else if (window.userSelections.proxyMethod === 'proxyhttp') {
                                    loadProxyHTTPAddresses();
                                } else if (window.userSelections.proxyMethod === 'proxysock5') {
                                    loadProxySocks5Addresses();
                                }

                                // 如果已选择代理地址，恢复选中状态
                                if (window.userSelections.proxySelection) {
                                    // 使用更长的延迟确保地址已加载
                                    setTimeout(() => {
                                        const items = document.querySelectorAll('.proxy-address-item');
                                        items.forEach(item => {
                                            item.classList.remove('selected');
                                            if (item.dataset.address === window.userSelections.proxySelection) {
                                                item.classList.add('selected');
                                            }
                                        });
                                    }, 1000); // 增加延迟时间到1000ms
                                }
                            }
                        }
                        // 如果是路由地址按钮，显示路由地址选择页
                        else if (buttonId === 'config-route-address') {
                            document.getElementById('route-address-step').style.display = 'flex';

                            // 加载workers数据 - 已在updateStepDisplay中调用

                            // 如果已选择worker，恢复选中状态
                            if (window.userSelections.worker) {
                                // 使用更长的延迟确保workers已加载
                                setTimeout(() => {
                                    const items = document.querySelectorAll('.worker-item');
                                    items.forEach(item => {
                                        item.classList.remove('selected');
                                        if (item.dataset.worker === window.userSelections.worker) {
                                            item.classList.add('selected');
                                        }
                                    });
                                }, 1000); // 增加延迟时间到1000ms
                            }
                        }

                        else if (buttonId !== 'export-config') {
                            // 显示欢迎页
                            document.getElementById('welcome-step').style.display = 'flex';
                        }

                        // 如果已选择接入方式，恢复左侧列的已配置提示
                        if (window.userSelections.accessMethod) {
                            window.updateLeftStepStatus(1, '已配置');
                        }

                        // 如果已选择端口，恢复左侧列的已配置提示
                        if (window.userSelections.port) {
                            window.updateLeftStepStatus(3, '已配置');
                        }
                        // 如果已选择代理方式，恢复左侧列的已配置提示
                        if (window.userSelections.proxyMethod) {
                            window.updateLeftStepStatus(5, '已配置');
                        }
                    });
                }
            });

            // 添加端口按钮选择逻辑
            const portButtons = document.querySelectorAll('.port-button');
            portButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // 移除所有端口按钮的选中状态
                    portButtons.forEach(btn => {
                        btn.classList.remove('selected');
                    });
                    // 添加当前按钮的选中状态
                    button.classList.add('selected');

                    // 保存用户选择的协议和端口
                    window.userSelections.protocol = button.dataset.protocol;
                    window.userSelections.port = button.dataset.port;

                    // 保存到localStorage
                    localStorage.setItem('userSelections', JSON.stringify(window.userSelections));

                    // 在左侧第三步子容器右上角显示选择状态
                    window.updateLeftStepStatus(3, '已配置');
                });
            });


            // 添加代理方式按钮选择逻辑
            const proxyMethodButtons = document.querySelectorAll('#proxyip-btn, #proxygroup-btn');
            proxyMethodButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // 移除所有代理方式按钮的选中状态
                    proxyMethodButtons.forEach(btn => {
                        btn.classList.remove('selected');
                    });
                    // 添加当前按钮的选中状态
                    button.classList.add('selected');

                    // 保存用户选择的代理方式
                    window.userSelections.proxyMethod = button.dataset.method;

                    // 如果之前已选择代理地址，清空代理地址的配置状态
                    if (window.userSelections.proxySelection) {
                        window.userSelections.proxySelection = null;
                        // 清空左侧第六步的已配置状态
                        window.updateLeftStepStatus(6, '');
                    }

                    // 保存到localStorage
                    localStorage.setItem('userSelections', JSON.stringify(window.userSelections));

                    // 在左侧第五步子容器右上角显示选择状态
                    window.updateLeftStepStatus(5, '已配置');
                });
            });

            // 加载Proxy IP Group数据函数
            window.loadProxyGroupAddresses = function() {
                const addressContainer = document.getElementById('proxy-address-container');
                const codeFilterContainer = document.getElementById('proxy-code-filter-container');
                addressContainer.innerHTML = ''; // 清空容器
                codeFilterContainer.innerHTML = ''; // 清空code筛选按钮容器
                codeFilterContainer.style.display = 'flex'; // 显示code筛选按钮容器

                // 获取当前UUID
                const currentUUID = document.getElementById('uuid-input').value;

                // 从API获取Proxy IP Group数据
                fetch(`/api/auth?uuid=${currentUUID}&get_proxyipgroup=true`)
                    .then(response => {
                        if (!response.ok) {
                            console.error('获取Proxy IP Group数据失败');
                            throw new Error('获取Proxy IP Group数据失败');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // 存储原始数据
                        window.proxyGroupData = data;

                        // 创建地区代码按钮
                        Object.keys(data).forEach(code => {
                            // 跳过ID键
                            if (code === 'ID') return;

                            const codeButton = document.createElement('button');
                            codeButton.className = 'code-filter-button';
                            codeButton.dataset.code = code;

                            // 创建橙色加粗的地区代码和小字数字
                            codeButton.innerHTML = `<span style="color: #ff9800; font-weight: bold;">${code}</span> &nbsp; <span style="font-size: 12px; color: #888;">${data[code]}</span>`;

                            // 设置按钮样式，使其上下居中
                            codeButton.style.display = 'flex';
                            codeButton.style.alignItems = 'center';
                            codeButton.style.justifyContent = 'center';

                            // 添加点击事件
                            codeButton.addEventListener('click', function() {
                                // 移除所有按钮的选中状态
                                document.querySelectorAll('.code-filter-button').forEach(btn => {
                                    btn.classList.remove('selected');
                                });

                                // 只选中当前点击的按钮
                                this.classList.add('selected');

                                // 保存用户选择的地区代码
                                window.userSelections.proxySelection = code;

                                // 保存到localStorage
                                localStorage.setItem('userSelections', JSON.stringify(window.userSelections));

                                // 在左侧第六步子容器右上角显示选择状态
                                window.updateLeftStepStatus(6, '已配置');
                            });

                            codeFilterContainer.appendChild(codeButton);
                        });
                    })
                    .catch(error => {
                        console.error('加载Proxy IP Group数据失败:', error);
                        // 不显示错误提示，保持容器为空
                    });
            }

            // 加载代理HTTP地址函数
            function loadProxyHTTPAddresses() {
                const addressContainer = document.getElementById('proxy-address-container');
                const codeFilterContainer = document.getElementById('proxy-code-filter-container');
                addressContainer.innerHTML = ''; // 清空容器
                codeFilterContainer.innerHTML = ''; // 清空code筛选按钮容器
                codeFilterContainer.style.display = 'none'; // 默认隐藏code筛选按钮容器

                // 检查是否正在加载中
                if (window.proxyhttpDataLoading) {
                    return;
                }

                // 设置加载状态
                window.proxyhttpDataLoading = true;

                // 获取当前UUID
                const currentUUID = document.getElementById('uuid-input').value;

                // 从API获取代理HTTP数据
                fetch(`/api/auth?uuid=${currentUUID}&get_proxyhttp=true`)
                    .then(response => {
                        if (!response.ok) {
                            console.error('获取代理HTTP数据失败');
                            throw new Error('获取代理HTTP数据失败');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // 存储原始数据
                        window.proxyhttpData = data;

                        // 清除加载状态
                        window.proxyhttpDataLoading = false;

                        // 显示code筛选按钮容器
                        codeFilterContainer.style.display = 'flex';

                        // 提取所有唯一的code值
                        const uniqueCodes = [...new Set(data.map(item => item.code))];

                        // 创建code筛选按钮
                        uniqueCodes.forEach(code => {
                            const codeButton = document.createElement('button');
                            codeButton.className = 'code-filter-button';
                            codeButton.dataset.code = code;
                            codeButton.textContent = code;

                            // 添加点击事件
                            codeButton.addEventListener('click', function() {
                                // 切换选中状态
                                this.classList.toggle('selected');

                                // 获取所有选中的code
                                const selectedCodes = Array.from(document.querySelectorAll('.code-filter-button.selected'))
                                    .map(btn => btn.dataset.code);

                                // 保存选中的code到localStorage
                                localStorage.setItem('selectedProxyhttpCodes', JSON.stringify(selectedCodes));

                                // 筛选代理地址
                                filterProxyhttpAddresses(selectedCodes);
                            });

                            codeFilterContainer.appendChild(codeButton);
                        });

                        // 恢复code筛选状态
                        restoreProxyhttpCodeFilterState();
                    })
                    .catch(error => {
                        console.error('加载代理HTTP地址失败:', error);
                        // 清除加载状态
                        window.proxyhttpDataLoading = false;
                        // 不显示错误提示，保持容器为空
                    });
            }

            // 筛选代理HTTP地址函数
            function filterProxyhttpAddresses(selectedCodes) {
                // 如果没有选中任何code，显示所有地址
                if (selectedCodes.length === 0) {
                    renderProxyhttpAddresses(window.proxyhttpData);
                    return;
                }

                // 筛选出符合选中code的地址
                const filteredData = window.proxyhttpData.filter(item =>
                    selectedCodes.includes(item.code)
                );

                // 渲染筛选后的地址
                renderProxyhttpAddresses(filteredData);
            }

            // 渲染代理HTTP地址函数
            function renderProxyhttpAddresses(data) {
                const addressContainer = document.getElementById('proxy-address-container');
                const codeFilterContainer = document.getElementById('proxy-code-filter-container');
                addressContainer.innerHTML = ''; // 清空容器
                codeFilterContainer.style.display = 'none'; // 默认隐藏code筛选按钮容器

                // 添加加载更多按钮
                const loadMoreButton = document.createElement('div');
                loadMoreButton.className = 'load-more-button';
                loadMoreButton.textContent = '加载更多';
                loadMoreButton.style.cssText = `
                    text-align: center;
                    padding: 10px;
                    margin: 10px 0;
                    background-color: rgba(255, 152, 0, 0.1);
                    border: 1px solid #ff9800;
                    border-radius: 5px;
                    cursor: pointer;
                    color: #ff9800;
                    font-weight: 500;
                    transition: all 0.2s ease;
                `;

                // 初始显示数量
                const initialCount = 19;
                let currentIndex = 0;

                // 懒加载函数
                function loadMoreItems() {
                    const endIndex = Math.min(currentIndex + initialCount, data.length);

                    for (let i = currentIndex; i < endIndex; i++) {
                        const item = data[i];
                        const addressItem = document.createElement('div');
                        addressItem.className = 'proxy-address-item';
                        addressItem.dataset.address = `${item.ip}:${item.port}`;

                        // 创建主文本和副文本
                        const mainText = document.createElement('div');
                        mainText.className = 'proxy-address-main-text';
                        mainText.textContent = `${item.ip}:${item.port}`;

                        const subText = document.createElement('div');
                        subText.className = 'proxy-address-sub-text';
                        subText.textContent = `${item.code} & ${item.asn}`;

                        addressItem.appendChild(mainText);
                        addressItem.appendChild(subText);

                        // 添加点击事件
                        addressItem.addEventListener('click', function() {
                            // 移除所有地址项的选中状态
                            document.querySelectorAll('.proxy-address-item').forEach(item => {
                                item.classList.remove('selected');
                            });
                            // 添加当前项的选中状态
                            addressItem.classList.add('selected');

                            // 保存用户选择的代理地址
                            window.userSelections.proxySelection = `${item.ip}:${item.port}`;

                            // 保存到localStorage
                            localStorage.setItem('userSelections', JSON.stringify(window.userSelections));

                            // 在左侧第六步子容器右上角显示选择状态
                            window.updateLeftStepStatus(6, '已配置');
                        });

                        addressContainer.appendChild(addressItem);
                    }

                    currentIndex = endIndex;

                    // 移除现有的加载更多按钮（如果存在）
                    const existingButton = addressContainer.querySelector('.load-more-button');
                    if (existingButton) {
                        addressContainer.removeChild(existingButton);
                    }

                    // 如果还有更多数据，添加加载更多按钮到列表末尾
                    if (currentIndex < data.length) {
                        addressContainer.appendChild(loadMoreButton);
                    }
                }

                // 添加加载更多按钮点击事件
                loadMoreButton.addEventListener('click', loadMoreItems);

                // 添加鼠标悬停效果
                loadMoreButton.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = 'rgba(255, 152, 0, 0.2)';
                });

                loadMoreButton.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = 'rgba(255, 152, 0, 0.1)';
                });

                // 如果有数据，显示code筛选按钮容器
                if (data.length > 0) {
                    codeFilterContainer.style.display = 'flex';
                }

                // 初始加载一批数据
                loadMoreItems();
            }

            // 恢复代理HTTP code筛选状态函数
            function restoreProxyhttpCodeFilterState() {
                // 从localStorage获取之前选中的code
                const savedCodes = localStorage.getItem('selectedProxyhttpCodes');
                let selectedCodes = [];

                if (savedCodes) {
                    try {
                        selectedCodes = JSON.parse(savedCodes);
                    } catch (e) {
                        console.error('解析选中的code失败:', e);
                    }
                }

                // 如果有选中的code，恢复按钮选中状态
                if (selectedCodes.length > 0) {
                    document.querySelectorAll('.code-filter-button').forEach(btn => {
                        if (selectedCodes.includes(btn.dataset.code)) {
                            btn.classList.add('selected');
                        }
                    });

                    // 根据选中的code筛选代理地址
                    filterProxyhttpAddresses(selectedCodes);
                } else {
                    // 没有选中的code，显示所有代理地址
                    renderProxyhttpAddresses(window.proxyhttpData);
                }
            }

            // 加载代理Socks5地址函数
            function loadProxySocks5Addresses() {
                const addressContainer = document.getElementById('proxy-address-container');
                const codeFilterContainer = document.getElementById('proxy-code-filter-container');
                addressContainer.innerHTML = ''; // 清空容器
                codeFilterContainer.style.display = 'none'; // 默认隐藏code筛选按钮容器

                // 添加加载更多按钮
                const loadMoreButton = document.createElement('div');
                loadMoreButton.className = 'load-more-button';
                loadMoreButton.textContent = '加载更多';
                loadMoreButton.style.cssText = `
                    text-align: center;
                    padding: 10px;
                    margin: 10px 0;
                    background-color: rgba(255, 152, 0, 0.1);
                    border: 1px solid #ff9800;
                    border-radius: 5px;
                    cursor: pointer;
                    color: #ff9800;
                    font-weight: 500;
                    transition: all 0.2s ease;
                `;

                // 获取当前UUID
                const currentUUID = document.getElementById('uuid-input').value;

                // 从API获取代理Socks5数据
                fetch(`/api/auth?uuid=${currentUUID}&get_proxysock5=true`)
                    .then(response => {
                        if (!response.ok) {
                            console.error('获取代理Socks5数据失败');
                            throw new Error('获取代理Socks5数据失败');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // 存储原始数据
                        window.proxysock5Data = data;

                        // 初始显示数量
                        const initialCount = 19;
                        let currentIndex = 0;

                        // 懒加载函数
                        function loadMoreItems() {
                            const endIndex = Math.min(currentIndex + initialCount, data.length);

                            for (let i = currentIndex; i < endIndex; i++) {
                                const item = data[i];
                                const addressItem = document.createElement('div');
                                addressItem.className = 'proxy-address-item';
                                addressItem.dataset.address = `${item.ip}:${item.port}`;

                                // 创建主文本和副文本
                                const mainText = document.createElement('div');
                                mainText.className = 'proxy-address-main-text';
                                mainText.textContent = `${item.ip}:${item.port}`;

                                const subText = document.createElement('div');
                                subText.className = 'proxy-address-sub-text';
                                subText.textContent = `${item.code} & ${item.asn}`;

                                addressItem.appendChild(mainText);
                                addressItem.appendChild(subText);

                                // 添加点击事件
                                addressItem.addEventListener('click', function() {
                                    // 移除所有地址项的选中状态
                                    document.querySelectorAll('.proxy-address-item').forEach(item => {
                                        item.classList.remove('selected');
                                    });
                                    // 添加当前项的选中状态
                                    addressItem.classList.add('selected');

                                    // 保存用户选择的代理地址
                                    window.userSelections.proxySelection = `${item.ip}:${item.port}`;

                                    // 保存到localStorage
                                    localStorage.setItem('userSelections', JSON.stringify(window.userSelections));

                                    // 在左侧第六步子容器右上角显示选择状态
                                    window.updateLeftStepStatus(6, '已配置');
                                });

                                addressContainer.appendChild(addressItem);
                            }

                            currentIndex = endIndex;

                            // 移除现有的加载更多按钮（如果存在）
                            const existingButton = addressContainer.querySelector('.load-more-button');
                            if (existingButton) {
                                addressContainer.removeChild(existingButton);
                            }

                            // 如果还有更多数据，添加加载更多按钮到列表末尾
                            if (currentIndex < data.length) {
                                addressContainer.appendChild(loadMoreButton);
                            }
                        }

                        // 添加加载更多按钮点击事件
                        loadMoreButton.addEventListener('click', loadMoreItems);

                        // 添加鼠标悬停效果
                        loadMoreButton.addEventListener('mouseenter', function() {
                            this.style.backgroundColor = 'rgba(255, 152, 0, 0.2)';
                        });

                        loadMoreButton.addEventListener('mouseleave', function() {
                            this.style.backgroundColor = 'rgba(255, 152, 0, 0.1)';
                        });

                        // 如果有数据，显示code筛选按钮容器
                        if (data.length > 0) {
                            codeFilterContainer.style.display = 'flex';
                        }

                        // 初始加载一批数据
                        loadMoreItems();
                    })
                    .catch(error => {
                        console.error('加载代理Socks5地址失败:', error);
                        // 不显示错误提示，保持容器为空
                    });
            }

            // 添加域名和IP按钮选择逻辑
            const domainBtn = document.getElementById('domain-btn');
            const ipBtn = document.getElementById('ip-btn');

            if (domainBtn && ipBtn) {
                // 域名按钮点击事件
                domainBtn.addEventListener('click', function() {
                    // 移除IP按钮的选中状态
                    ipBtn.classList.remove('selected');
                    // 添加域名按钮的选中状态
                    domainBtn.classList.add('selected');
                    // 在左侧第一步子容器右上角显示选择状态
                    window.updateLeftStepStatus(1, '已配置');
                    // 保存用户选择
                    window.userSelections.accessMethod = 'domain';

                    // 如果之前已选择接入地址，清空接入地址的配置状态
                    if (window.userSelections.accessSelection) {
                        window.userSelections.accessSelection = null;
                        // 清空左侧第二步的已配置状态
                        window.updateLeftStepStatus(2, '');
                    }

                    // 保存到localStorage
                    localStorage.setItem('userSelections', JSON.stringify(window.userSelections));
                });

                // IP按钮点击事件
                ipBtn.addEventListener('click', function() {
                    // 移除域名按钮的选中状态
                    domainBtn.classList.remove('selected');
                    // 添加IP按钮的选中状态
                    ipBtn.classList.add('selected');
                    // 在左侧第一步子容器右上角显示选择状态
                    window.updateLeftStepStatus(1, '已配置');
                    // 保存用户选择
                    window.userSelections.accessMethod = 'ip';

                    // 如果之前已选择接入地址，清空接入地址的配置状态
                    if (window.userSelections.accessSelection) {
                        window.userSelections.accessSelection = null;
                        // 清空左侧第二步的已配置状态
                        window.updateLeftStepStatus(2, '');
                    }

                    // 保存到localStorage
                    localStorage.setItem('userSelections', JSON.stringify(window.userSelections));
                });
            }

            // 添加关于服务按钮点击事件
            const aboutServiceBtn = document.getElementById('about-service');
            if (aboutServiceBtn) {
                aboutServiceBtn.addEventListener('click', function() {
                    // 隐藏所有步骤内容
                    document.querySelectorAll('[id$="-step"]').forEach(el => {
                        el.style.display = 'none';
                    });
                    // 显示欢迎页
                    document.getElementById('welcome-step').style.display = 'flex';

                    // 保留已选配置状态，不清除按钮选中状态和左侧列状态
                    // 如果已选择接入方式，保留左侧列的已配置提示
                    if (window.userSelections.accessMethod) {
                        window.updateLeftStepStatus(1, '已配置');
                    }
                });
            }

            // 添加清空配置按钮点击事件
            const clearConfigBtn = document.getElementById('clear-config');
            if (clearConfigBtn) {
                clearConfigBtn.addEventListener('click', function() {
                    // 重置用户选择
                    window.userSelections = {
                        accessMethod: null,  // 'domain' 或 'ip'
                        accessSelection: null,  // 选择的域名或IP
                        protocol: null,  // 选择的协议 'http' 或 'https'
                        port: null,  // 选择的端口
                        worker: null,  // 选择的worker
                        proxyMethod: null,  // 'proxyip', 'proxygroup'
                        proxySelection: null  // 选择的代理
                    };

                    // 清除localStorage中的数据
                    localStorage.removeItem('userSelections');

                    // 隐藏所有步骤内容
                    document.querySelectorAll('[id$="-step"]').forEach(el => {
                        el.style.display = 'none';
                    });
                    // 显示欢迎页
                    document.getElementById('welcome-step').style.display = 'flex';
                    // 清除所有按钮的选中状态
                    document.querySelectorAll('.access-method-button').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                    // 清除所有端口按钮的选中状态
                    document.querySelectorAll('.port-button').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                    // 清除所有代理方式按钮的选中状态
                    document.querySelectorAll('#proxyip-btn, #proxygroup-btn').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                    // 清除左侧步骤状态
                    document.querySelectorAll('.step-status').forEach(el => {
                        el.remove();
                    });

                });
            }
        });

        // 检查登录状态
        function checkLoginStatus() {
            const uuidCookie = getCookie('railgun_uuid');
            if (uuidCookie) {
                // 有cookie，直接从logo的图标动画开始
                document.getElementById('uuid-input').value = uuidCookie;
                document.getElementById('uuid-input').disabled = true;
                // 更新状态文本为已载入
                updateStatusText('UUID已载入', 'success');
                showIcon('success');

                // 模拟验证成功后的流程，确保动画顺序正确
                setTimeout(() => {
                    // 淡出logo容器
                    document.getElementById('logo-container').classList.add('fade-out');

                    // 禁用UUID输入框
                    document.getElementById('uuid-input').disabled = true;

                    // 修改验证按钮为登出按钮
                    const verifyBtn = document.getElementById('verify-btn');
                    verifyBtn.textContent = '登出UUID';

                    // 显示侧边容器和中间容器
                    setTimeout(() => {
                        document.getElementById('left-container').classList.add('active');
                        document.getElementById('right-container').classList.add('active');
                        document.getElementById('center-container').classList.add('active');

                        // 初始化CDN列表
                        initializeCDNList();
                        initializeSelectBoxes();
                    }, 1000);
                }, 2000);
            }
        }

        // 获取cookie
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        // 设置cookie，有效期7天
        function setCookie(name, value, days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = `expires=${date.toUTCString()}`;
            document.cookie = `${name}=${value};${expires};path=/`;
        }

        // 删除cookie
        function deleteCookie(name) {
            document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/`;
        }

        // 验证UUID功能
        document.getElementById('verify-btn').addEventListener('click', function() {
            const verifyBtn = document.getElementById('verify-btn');

            // 如果是登出操作
            if (verifyBtn.textContent === '登出UUID') {
                // 清空UUID输入框
                document.getElementById('uuid-input').value = '';
                document.getElementById('uuid-input').disabled = false;

                // 删除cookie
                deleteCookie('railgun_uuid');

                // 重置按钮文本
                verifyBtn.textContent = '验证UUID';
                verifyBtn.style.backgroundColor = 'rgba(255, 255, 255, 0.7)';

                // 重置状态文本
                const statusText = document.getElementById('status-text');
                statusText.textContent = 'UUID未载入';
                statusText.className = 'status-text';

                // 隐藏所有容器
                document.getElementById('left-container').classList.remove('active');
                document.getElementById('right-container').classList.remove('active');
                document.getElementById('center-container').classList.remove('active');

                // 显示logo
                document.getElementById('logo-img').style.opacity = '1';
                document.getElementById('logo-container').classList.remove('fade-out');
                document.getElementById('success-icon').classList.remove('active');

                return;
            }

            const uuidInput = document.getElementById('uuid-input');
            const uuid = uuidInput.value.trim();

            if (!uuid) {
                showIcon('error');
                updateStatusText('UUID不存在', 'error');
                return;
            }

            // 获取UUID列表
            fetch('/api/uuids')
                .then(response => response.json())
                .then(data => {
                    const found = data.find(item => item.uuid === uuid);

                    if (!found) {
                        // UUID不存在
                        showIcon('error');
                        updateStatusText('UUID不存在', 'error');
                    } else if (!found.statu) {
                        // UUID存在但状态为false
                        showIcon('warning');
                        updateStatusText('UUID被禁用', 'warning');
                    } else {
                        // UUID存在且状态为true
                        showIcon('success');
                        updateStatusText('UUID已载入', 'success');

                        // 设置cookie
                        setCookie('railgun_uuid', uuid, 7);
                    }
                })
                .catch(error => {
                    console.error('验证UUID失败:', error);
                    showIcon('error');
                    updateStatusText('UUID不存在', 'error');
                });
        });

        // 更新状态文本
        function updateStatusText(text, status) {
            const statusText = document.getElementById('status-text');
            statusText.textContent = text;
            statusText.className = 'status-text ' + status;
        }

        // 显示图标动画
        function showIcon(type) {
            const logoImg = document.getElementById('logo-img');
            const logoContainer = document.getElementById('logo-container');
            const successIcon = document.getElementById('success-icon');
            const warningIcon = document.getElementById('warning-icon');
            const errorIcon = document.getElementById('error-icon');

            // 隐藏logo，显示对应图标
            logoImg.style.opacity = '0';

            // 隐藏所有图标
            successIcon.classList.remove('active');
            warningIcon.classList.remove('active');
            errorIcon.classList.remove('active');

            // 显示对应图标
            setTimeout(() => {
                if (type === 'success') {
                    successIcon.classList.add('active');
                    // 验证通过后的特殊处理
                    setTimeout(() => {
                        // 淡出logo容器
                        logoContainer.classList.add('fade-out');

                        // 禁用UUID输入框
                        document.getElementById('uuid-input').disabled = true;

                        // 修改验证按钮为登出按钮
                        const verifyBtn = document.getElementById('verify-btn');
                        verifyBtn.textContent = '登出UUID';
                        // 保持原始颜色，不改为绿色

                        // 显示侧边容器和中间容器
                        setTimeout(() => {
                            document.getElementById('left-container').classList.add('active');
                            document.getElementById('right-container').classList.add('active');
                            document.getElementById('center-container').classList.add('active');

                            // 初始化CDN列表
                            initializeCDNList();
                            initializeSelectBoxes();

                            // 初始化步骤导航
                            initializeStepNavigation();
                        }, 1000);
                    }, 2000);
                } else if (type === 'warning') {
                    warningIcon.classList.add('active');
                } else if (type === 'error') {
                    errorIcon.classList.add('active');
                }
            }, 300);

            // 非成功情况3秒后恢复logo
            if (type !== 'success') {
                setTimeout(() => {
                    successIcon.classList.remove('active');
                    warningIcon.classList.remove('active');
                    errorIcon.classList.remove('active');
                    logoImg.style.opacity = '1';
                }, 3000);
            }
        }

        // 初始化CDN列表
        function initializeCDNList() {
            // 不需要在这里加载CDN列表，因为它会在步骤导航中加载
            console.log('CDN列表初始化完成');
        }

        // 初始化按钮事件
        function initializeSelectBoxes() {
            // 不需要在这里初始化按钮事件，因为它们会在步骤导航中处理
            console.log('按钮事件初始化完成');
        }

        // 初始化步骤导航功能
        function initializeStepNavigation() {
            // 确保元素存在
            const domainBtn = document.getElementById('domain-btn');
            const ipBtn = document.getElementById('ip-btn');

            // 当前步骤，初始为0表示欢迎页
            window.currentStep = 0;
            // 最大步骤数
            const maxSteps = 6;

            // 存储用户选择
            window.userSelections = {
                accessMethod: null,  // 'domain' 或 'ip'
                accessSelection: null,  // 选择的域名或IP
                port: null,  // 选择的端口
                worker: null,  // 选择的worker
                proxyMethod: null,  // 'proxyip', 'proxygroup'
                proxySelection: null  // 选择的代理
            };

            // 确保中间容器可见
            const centerContainer = document.getElementById('center-container');
            if (centerContainer) {
                centerContainer.classList.add('active');
            }

            // 接入方式按钮点击事件
            if (domainBtn) {
                domainBtn.addEventListener('click', function() {
                    window.userSelections.accessMethod = 'domain';
                    console.log('选择了域名接入方式');
                });
            }

            if (ipBtn) {
                ipBtn.addEventListener('click', function() {
                    window.userSelections.accessMethod = 'ip';
                    console.log('选择了IP接入方式');
                });
            }

            // 添加代理方式按钮点击事件
            const proxyipBtn = document.getElementById('proxyip-btn');
            const proxyhttpBtn = document.getElementById('proxyhttp-btn');
            const proxysock5Btn = document.getElementById('proxysock5-btn');

            if (proxyipBtn) {
                proxyipBtn.addEventListener('click', function() {
                    window.userSelections.proxyMethod = 'proxyip';
                    console.log('选择了ProxyIP代理方式');
                });
            }

            if (proxyhttpBtn) {
                proxyhttpBtn.addEventListener('click', function() {
                    window.userSelections.proxyMethod = 'proxyhttp';
                    console.log('选择了ProxyHTTP代理方式');
                });
            }

            if (proxysock5Btn) {
                proxysock5Btn.addEventListener('click', function() {
                    window.userSelections.proxyMethod = 'proxysock5';
                    console.log('选择了ProxySocks5代理方式');
                });
            }

            // 添加端口选择事件
            document.querySelectorAll('.port-option').forEach(option => {
                option.addEventListener('click', function() {
                    // 移除其他选中状态
                    document.querySelectorAll('.port-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    // 添加当前选中状态
                    this.classList.add('selected');
                    // 保存选择的端口
                    window.userSelections.port = this.getAttribute('data-port');
                    console.log('选择了端口:', window.userSelections.port);
                });
            });

            // 更新步骤显示
            window.updateStepDisplay = function() {
                console.log('更新步骤显示，当前步骤:', window.currentStep);

                // 隐藏所有步骤内容
                document.querySelectorAll('[id$="-step"], #welcome-step').forEach(el => {
                    el.style.display = 'none';
                });

                // 显示当前步骤内容
                if (window.currentStep === 0) {
                    // 初始步
                    console.log('显示初始步');
                    document.getElementById('welcome-step').style.display = 'flex';
                } else if (window.currentStep === 1) {
                    // 第一步：接入方式
                    console.log('显示接入方式');
                    document.getElementById('access-method-step').style.display = 'flex';
                } else if (window.currentStep === 2) {
                    // 第二步：接入地址
                    console.log('显示接入地址');
                    document.getElementById('access-address-step').style.display = 'flex';
                    // 根据选择的接入方式加载相应数据
                    if (window.userSelections.accessMethod === 'domain') {
                        loadDomainAddresses();
                    } else if (window.userSelections.accessMethod === 'ip') {
                        loadIPAddresses();
                    }
                } else if (window.currentStep === 3) {
                    // 第三步：接入协议
                    console.log('显示接入协议');
                    document.getElementById('access-protocol-step').style.display = 'flex';
                } else if (window.currentStep === 4) {
                    // 第四步：路由地址
                    console.log('显示路由地址');
                    document.getElementById('route-address-step').style.display = 'flex';
                    // 加载Workers数据
                    loadWorkers();
                } else if (window.currentStep === 5) {
                    // 第五步：代理方式
                    console.log('显示代理方式');
                    document.getElementById('proxy-method-step').style.display = 'flex';
                } else if (window.currentStep === 6) {
                    // 第六步：代理地址
                    console.log('显示代理地址');

                    // 检查是否已选择代理方式
                    if (!window.userSelections.proxyMethod) {
                        console.log('未选择代理方式，不加载代理地址');
                        document.getElementById('proxy-address-step').style.display = 'flex';

                        // 清空代理地址和code筛选按钮容器
                        const addressContainer = document.getElementById('proxy-address-container');
                        const codeFilterContainer = document.getElementById('proxy-code-filter-container');
                        addressContainer.innerHTML = '';
                        codeFilterContainer.innerHTML = '';
                        codeFilterContainer.style.display = 'none';

                        return;
                    }

                    document.getElementById('proxy-address-step').style.display = 'flex';
                    // 根据选择的代理方式加载相应数据
                    if (window.userSelections.proxyMethod === 'proxyip') {
                        loadProxyIPAddresses();
                    } else if (window.userSelections.proxyMethod === 'proxygroup') {
                        window.loadProxyGroupAddresses();
                    }
                } else if (window.currentStep > 6) {
                    // 最终步：生成配置
                    console.log('显示生成配置');
                    // 这里可以添加生成配置的代码
                }

                // 更新侧边栏高亮
                updateSidebarHighlight();

                // 确保中间容器可见
                const centerContainer = document.getElementById('center-container');
                if (centerContainer) {
                    centerContainer.classList.add('active');
                }
            }

            // 更新侧边栏高亮
            function updateSidebarHighlight() {
                // 移除所有高亮
                document.querySelectorAll('.sub-container').forEach(el => {
                    el.classList.remove('active');
                });

                // 高亮当前步骤
                if (window.currentStep >= 1 && window.currentStep <= maxSteps) {
                    const leftSubs = document.querySelectorAll('.left-container .sub-container');
                    const rightSubs = document.querySelectorAll('.right-container .sub-container');

                    // 高亮左侧和右侧对应的步骤
                    for (let i = 0; i < window.currentStep; i++) {
                        if (leftSubs[i]) leftSubs[i].classList.add('active');
                        if (rightSubs[i]) rightSubs[i].classList.add('active');
                    }
                }
            }

            // 初始化显示
            window.currentStep = 0;

            // 确保初始步内容正确显示
            document.getElementById('welcome-step').style.display = 'flex';

            window.updateStepDisplay();

            // 添加右侧按钮点击事件
            document.getElementById('about-service').addEventListener('click', function() {
                window.currentStep = 0;
                window.updateStepDisplay();
            });

            document.getElementById('config-access-method').addEventListener('click', function() {
                window.currentStep = 1;
                window.updateStepDisplay();
            });

            document.getElementById('config-access-address').addEventListener('click', function() {
                window.currentStep = 2;
                window.updateStepDisplay();
            });

            document.getElementById('config-access-protocol').addEventListener('click', function() {
                window.currentStep = 3;
                window.updateStepDisplay();
            });

            document.getElementById('config-route-address').addEventListener('click', function() {
                window.currentStep = 4;
                window.updateStepDisplay();
            });

            document.getElementById('config-proxy-method').addEventListener('click', function() {
                window.currentStep = 5;
                window.updateStepDisplay();
            });

            document.getElementById('config-proxy-address').addEventListener('click', function() {
                window.currentStep = 6;
                window.updateStepDisplay();
            });

            document.getElementById('export-config').addEventListener('click', function() {
                // 从localStorage获取最新的用户选择
                const savedSelections = localStorage.getItem('userSelections');
                if (!savedSelections) {
                    showConfigMessage('请先完成配置流程');
                    return;
                }

                let userSelections;
                try {
                    userSelections = JSON.parse(savedSelections);
                } catch (e) {
                    console.error('解析用户选择失败:', e);
                    showConfigMessage('配置数据错误，请重新配置');
                    return;
                }

                // 检查是否所有必要配置都已选择
                if (!userSelections.accessMethod || !userSelections.port ||
                    !userSelections.accessSelection || !userSelections.worker ||
                    !userSelections.proxyMethod || !userSelections.proxySelection) {
                    showConfigMessage('请检查配置流程是否全部完成');
                    return;
                }

                // 生成配置URL
                const uuid = getCookie('railgun_uuid');
                const accessAddress = userSelections.accessSelection;
                const port = userSelections.port;
                const routeAddress = userSelections.worker;
                const proxyMethod = userSelections.proxyMethod;
                const proxySelection = userSelections.proxySelection;

                // 根据代理方式生成不同的path
                let path;
                if (proxyMethod === 'proxygroup') {
                    // Proxy IP Group使用/proxyip=地区代码的格式
                    path = `/proxyip=${proxySelection}`;
                } else {
                    // 其他代理方式使用原有格式
                    path = `/${proxyMethod}://${proxySelection}`;
                }

                const configUrl = `vless://${uuid}@${accessAddress}:${port}?encryption=none&security=tls&sni=${routeAddress}&fp=random&type=ws&host=${routeAddress}&path=${path}#railgun`;

                // 显示配置信息
                showConfigResult(configUrl);

                // 将配置URL保存到localStorage，以便页面刷新时使用
                localStorage.setItem('lastConfigUrl', configUrl);
            });

            // 通用的消息显示函数
            function showConfigMessage(message) {
                // 隐藏所有步骤内容
                document.querySelectorAll('[id$="-step"], #welcome-step').forEach(el => {
                    el.style.display = 'none';
                });

                // 创建配置容器
                const configContainer = document.createElement('div');
                configContainer.className = 'config-container';
                configContainer.innerHTML = `<div style="color: #888; text-align: center; padding: 20px; font-size: 14px;">${message}</div>`;

                // 创建配置步骤容器
                const configStep = document.createElement('div');
                configStep.id = 'config-step';
                configStep.style.display = 'flex';
                configStep.style.flexDirection = 'column';
                configStep.style.justifyContent = 'center';
                configStep.style.alignItems = 'center';
                configStep.style.height = '100%';
                configStep.style.width = '100%';
                configStep.appendChild(configContainer);

                // 添加到中间容器
                const centerContainer = document.querySelector('.center-container');
                centerContainer.appendChild(configStep);
            }

            // 显示配置结果
            function showConfigResult(configUrl) {
                // 隐藏所有步骤内容
                document.querySelectorAll('[id$="-step"], #welcome-step').forEach(el => {
                    el.style.display = 'none';
                });

                // 创建配置容器
                const configContainer = document.createElement('div');
                configContainer.className = 'config-container';
                configContainer.innerHTML = `
                    <div id="configUrlContainer" style="width: 100%; margin-bottom: 20px; background-color: transparent; border: 2px solid #ff9500; padding: 15px; border-radius: 10px; word-break: break-all; font-family: monospace;">
                        ${configUrl}
                    </div>
                `;

                // 创建配置步骤容器并添加到页面
                const configStep = document.createElement('div');
                configStep.id = 'config-step';
                configStep.style.display = 'flex';
                configStep.style.flexDirection = 'column';
                configStep.style.justifyContent = 'center';
                configStep.style.alignItems = 'center';
                configStep.style.height = '100%';
                configStep.style.width = '100%';
                configStep.appendChild(configContainer);

                // 添加到中间容器
                const centerContainer = document.querySelector('.center-container');
                centerContainer.appendChild(configStep);

            }

            document.getElementById('clear-config').addEventListener('click', function() {
                // 清空所有用户选择
                window.userSelections = {
                    accessMethod: null,
                    accessSelection: null,
                    port: null,
                    worker: null,
                    proxyMethod: null,
                    proxySelection: null
                };

                // 清空localStorage
                localStorage.removeItem('userSelections');
                // 清空code筛选记录
                localStorage.removeItem('selectedProxyCodes');

                // 重置步骤到初始状态
                window.currentStep = 0;
                window.updateStepDisplay();

                // 清空所有已配置状态
                for (let i = 1; i <= 6; i++) {
                    window.updateLeftStepStatus(i, '');
                }

                // 重置代理地址筛选状态
                document.querySelectorAll('.code-filter-button').forEach(btn => {
                    btn.classList.remove('selected');
                });
            });
        }

    </script>
</body>
</html>